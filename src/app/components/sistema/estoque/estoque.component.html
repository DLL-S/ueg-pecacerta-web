<app-notify></app-notify>

<p-table #dt id="column-item" [value]="movimentacoes" [rows]="10" [paginator]="true"
	[globalFilterFields]="['codigo','operacao', 'produto.nome']" [rowHover]="true" dataKey="codigo"
	styleClass="p-datatable-responsive-demo"
	currentPageReportTemplate="Exibindo de {first} à {last} do total de {totalRecords} entradas"
	[showCurrentPageReport]="true">

	<ng-template pTemplate="caption">
		<div class="p-d-flex p-ai-center p-jc-between">
			Movimentações de Estoque
			<span style="display: inherit;">
				<button pButton style="margin-right: 0.5em; margin-left: 0.5em;" icon="pi pi-plus"
					pTooltip="Registrar Troca" tooltipPosition="top" (click)="novoDialogo()"></button>
				<button pButton style="margin-right: 0.5em;" (click)="recarregarPagina()" pButton icon="pi pi-refresh"
					pTooltip="Recarregar" tooltipPosition="top"></button>

				<span class="p-input-icon-left">
					<i class="pi pi-search"></i>
					<input pInputText style="width: 100% !important;" type="text"
						(input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Pesquisar..." />
				</span>
			</span>
		</div>
	</ng-template>

	<ng-template pTemplate="header">
		<tr>
			<th pSortableColumn="codigo">Código <p-sortIcon field="codigo"></p-sortIcon>
			</th>
			<th pSortableColumn="produto">Produto <p-sortIcon field="produto"></p-sortIcon>
			</th>
			<th pSortableColumn="operacao">Operação <p-sortIcon field="operacao"></p-sortIcon>
			</th>
			<th pSortableColumn="data">Data <p-sortIcon field="data"></p-sortIcon>
			</th>
			<th pSortableColumn="quantidade">Quantidade <p-sortIcon field="quantidade"></p-sortIcon>
			</th>
		</tr>
	</ng-template>

	<ng-template pTemplate="body" let-movimentacao>
		<tr>
			<td>
				<span class="p-column-title">Código</span>
				{{ movimentacao.codigo }}
			</td>
			<td>
				<span class="p-column-title">Produto</span>
				{{ movimentacao.produto.codigo }} - {{ movimentacao.produto.nome }}
			</td>
			<td>
				<span class="p-column-title">Operação</span>
				{{ movimentacao.operacao }}
			</td>
			<td>
				<span class="p-column-title">Data</span>
				{{ movimentacao.data | date: "dd/MM/yyyy" }}
			</td>
			<td>
				<span class="p-column-title">Quantidade</span>
				{{ movimentacao.quantidade }}
			</td>
		</tr>
	</ng-template>
</p-table>

<form #dialogoForm="ngForm">
	<p-dialog [(visible)]="dialog" [style]="{width: '450px'}" header="Registrar Troca" [modal]="true"
		styleClass="p-fluid">

		<ng-template pTemplate="content">
			<div class="p-formgrid p-grid">

				<div class="p-field p-col">
					<label for="produto">Produto</label>
					<p-dropdown optionLabel="nome" [options]="produtos" ngModel id="produto" name="produto" #produto="ngModel"
					[(ngModel)]="movimentacao.produto" placeholder="Selecionar..." required
					aria-describedby="produto-helper">
				</p-dropdown>
				<app-messages id="produto-helper" [control]="produto" error="required" text="Selecione um Produto">
				</app-messages>
			</div>
			<div class="p-field p-col-3">
				<label for="qtdeEstoque">Quantidade</label>
				<input type="number" pInputText [(ngModel)]="movimentacao.quantidade" required min="0" ngModel
				  #qtdeEstoque="ngModel" id="qtdeEstoque" name="qtdeEstoque" placeholder="0"
				  aria-describedby="qtdeEstoque-helper">
				<app-messages id="qtdeEstoque-helper" [control]="qtdeEstoque" error="required"
				  text="Informe o estoque inicial"></app-messages>
				<app-messages id="qtdeEstoque-helper" [control]="qtdeEstoque" error="min"
				  text="Quantidade deve ser maior que 0"></app-messages>
			  </div>

			</div>
		</ng-template>

		<ng-template pTemplate="footer">
			<button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
				(click)="esconderDialogo()"></button>
			<button pButton pRipple type="submit" label="Salvar" icon="pi pi-check" class="p-button-text"
				(click)="salvar()" [disabled]="!dialogoForm.valid"></button>
		</ng-template>

	</p-dialog>
</form>
